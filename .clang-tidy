---
# =============================================================================
# C/C++ Code Standards - Static Analysis Configuration
# =============================================================================
# Reference: https://clang.llvm.org/extra/clang-tidy/checks/list.html
#
# To use: Place this file in your project root
# Run: clang-tidy src/**/*.c -- -I./include
#
# This configuration enables safety-critical checks including:
# - CERT C secure coding guidelines
# - Buffer overflow prevention
# - Null pointer detection
# - Resource leak detection
# - Security vulnerability detection
# =============================================================================

# =============================================================================
# ENABLED CHECKS
# =============================================================================
# Enable safety-critical checks, disable noisy/irrelevant ones
Checks: >
  bugprone-*,
  cert-*,
  clang-analyzer-*,
  concurrency-*,
  misc-*,
  performance-*,
  readability-*,
  -bugprone-easily-swappable-parameters,
  -cert-dcl37-c,
  -cert-dcl51-cpp,
  -misc-no-recursion,
  -readability-function-cognitive-complexity,
  -readability-magic-numbers,
  -clang-analyzer-security.insecureAPI.DeprecatedOrUnsafeBufferHandling

# =============================================================================
# CRITICAL CHECKS - Treated as errors (will cause non-zero exit code)
# =============================================================================
# These checks map to Critical severity rules and should block merges
WarningsAsErrors: >
  bugprone-unused-return-value,
  clang-analyzer-core.NullDereference,
  clang-analyzer-core.uninitialized.*,
  clang-analyzer-unix.Malloc,
  clang-analyzer-unix.MallocSizeof,
  clang-analyzer-unix.MismatchedDeallocator,
  clang-analyzer-security.*,
  cert-err33-c,
  cert-err34-c,
  bugprone-use-after-move,
  bugprone-double-free,
  bugprone-sizeof-expression,
  bugprone-string-literal-with-embedded-nul

# =============================================================================
# CHECK OPTIONS
# =============================================================================
CheckOptions:
  # ---------------------------------------------------------------------------
  # Rule 20: Check return values of critical functions
  # ---------------------------------------------------------------------------
  # Functions whose return values must always be checked
  - key: bugprone-unused-return-value.CheckedFunctions
    value: >
      ::malloc;::calloc;::realloc;::aligned_alloc;
      ::fopen;::freopen;::fclose;::fflush;::fread;::fwrite;::fseek;::ftell;::fgetpos;::fsetpos;
      ::open;::close;::read;::write;::lseek;::dup;::dup2;::pipe;
      ::socket;::bind;::listen;::accept;::connect;::send;::recv;::sendto;::recvfrom;
      ::pthread_create;::pthread_join;::pthread_detach;
      ::pthread_mutex_init;::pthread_mutex_destroy;::pthread_mutex_lock;::pthread_mutex_unlock;
      ::pthread_cond_init;::pthread_cond_destroy;::pthread_cond_wait;::pthread_cond_signal;
      ::sem_init;::sem_destroy;::sem_wait;::sem_post;
      ::mmap;::munmap;::mprotect;
      ::fork;::execve;::waitpid

  # ---------------------------------------------------------------------------
  # Rule 21: Buffer overflow prevention
  # ---------------------------------------------------------------------------
  - key: bugprone-not-null-terminated-result.WantToUseSafeFunctions
    value: true

  # ---------------------------------------------------------------------------
  # Rule 30: Narrowing conversion warnings
  # ---------------------------------------------------------------------------
  - key: bugprone-narrowing-conversions.WarnOnIntegerNarrowingConversion
    value: true
  - key: bugprone-narrowing-conversions.WarnOnFloatingPointNarrowingConversion
    value: true
  - key: bugprone-narrowing-conversions.WarnOnIntegerToFloatingPointNarrowingConversion
    value: true
  - key: bugprone-narrowing-conversions.PedanticMode
    value: false

  # ---------------------------------------------------------------------------
  # Naming conventions (Minor rules - Rule 41+)
  # ---------------------------------------------------------------------------
  # Functions: lower_case or camelCase
  - key: readability-identifier-naming.FunctionCase
    value: lower_case

  # Variables: lower_case
  - key: readability-identifier-naming.VariableCase
    value: lower_case
  - key: readability-identifier-naming.LocalVariableCase
    value: lower_case
  - key: readability-identifier-naming.GlobalVariableCase
    value: lower_case

  # Constants and macros: UPPER_CASE
  - key: readability-identifier-naming.GlobalConstantCase
    value: UPPER_CASE
  - key: readability-identifier-naming.MacroDefinitionCase
    value: UPPER_CASE
  - key: readability-identifier-naming.EnumConstantCase
    value: UPPER_CASE
  - key: readability-identifier-naming.ConstexprVariableCase
    value: UPPER_CASE

  # Types: CamelCase
  - key: readability-identifier-naming.StructCase
    value: CamelCase
  - key: readability-identifier-naming.EnumCase
    value: CamelCase
  - key: readability-identifier-naming.TypedefCase
    value: CamelCase
  - key: readability-identifier-naming.TypeAliasCase
    value: CamelCase
  - key: readability-identifier-naming.ClassCase
    value: CamelCase

  # Parameters: lower_case
  - key: readability-identifier-naming.ParameterCase
    value: lower_case

  # ---------------------------------------------------------------------------
  # Other safety and style settings
  # ---------------------------------------------------------------------------
  - key: misc-unused-parameters.StrictMode
    value: false

  - key: readability-braces-around-statements.ShortStatementLines
    value: '0'

  - key: readability-implicit-bool-conversion.AllowIntegerConditions
    value: true
  - key: readability-implicit-bool-conversion.AllowPointerConditions
    value: true

  - key: readability-function-size.LineThreshold
    value: '100'
  - key: readability-function-size.StatementThreshold
    value: '50'
  - key: readability-function-size.ParameterThreshold
    value: '6'

  - key: performance-unnecessary-value-param.AllowedTypes
    value: ''

  - key: bugprone-assert-side-effect.AssertMacros
    value: 'assert,Assert,ASSERT'

  - key: bugprone-suspicious-string-compare.WarnOnImplicitComparison
    value: true
  - key: bugprone-suspicious-string-compare.WarnOnLogicalNotComparison
    value: true

# =============================================================================
# HEADER FILTER
# =============================================================================
# Analyze headers matching this regex (project headers, not system headers)
HeaderFilterRegex: '.*'

# =============================================================================
# FORMAT STYLE
# =============================================================================
# Use the .clang-format file for suggested fixes
FormatStyle: file

# =============================================================================
# SYSTEM HEADERS
# =============================================================================
# Don't analyze system headers
SystemHeaders: false
...
